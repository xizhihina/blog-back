import{d as H,r as u,g as O,x,k as s,o as c,c as w,l as o,u as h,G as j,y as n,F as D,s as E,A as y,e as f,t as J,H as M,f as C,I as W}from"./index-b004050c.js";import{i as d,o as X}from"./requests-6ec0e6c6.js";const le=H({__name:"EditArticle",setup(Y){const I=()=>{C.back()},F=(l,e)=>{console.log(l),console.log(e)},v=u(""),L=(l,e)=>{var i=new FormData;i.append("file",e),d.post("/api/image",i).then(p=>v.value.$img2Url(l,X.baseURL+"/"+p))},T=l=>{var e=l[0].split("/").pop();d.delete("/api/image/"+e).then(i=>{i==!1&&alert("删除失败")})},A=O(),U=u("default"),b=u(),t=x({id:A.query.id,title:"",tabloid:"",publishDate:"",readingQuantity:0,articleLanguage:[],content:""});d.get("api/blog/article/info/"+t.id).then(l=>{t.title=l.title,t.tabloid=l.tabloid,t.publishDate=l.publishDate,t.readingQuantity=l.readingQuantity}),d.get("api/blog/article/language/"+t.id).then(l=>{t.articleLanguage=l}),d.get("api/blog/article/content/"+t.id).then(l=>{t.content=l});const q=x({id:[{required:!0,message:"Please input Activity name"}],title:[{required:!0,message:"Please select Activity zone",trigger:"change"},{min:1,max:50,message:"长度必须在10以内且不能为空",trigger:"blur"}],tabloid:[{required:!0,message:"Please select Activity count",trigger:"change"},{min:1,max:200,message:"长度必须在30以内且不能为空",trigger:"blur"}],publishDate:[{required:!0,message:"Please pick a date",trigger:"change"}],readingQuantity:[{required:!0,message:"Please input Activity",trigger:"change"}],articleLanguage:[{required:!0,message:"Please select at least one activity type",trigger:"change"}]}),P=async l=>{l&&await l.validate((e,i)=>{e?d.post("/api/blog/article",t).then(p=>{p==!0&&(alert("修改成功"),C.push({name:"articleinfo"}))}):console.log("error submit!",i)})},Q=l=>{l&&l.resetFields()},z=Array.from({length:100}).map((l,e)=>({value:`${e+1}`,label:`${e+1}`})),_=u(!1),m=u(""),V=u(),R=l=>{t.articleLanguage.splice(t.articleLanguage.indexOf(l),1)},$=()=>{_.value=!0,W(()=>{V.value.input.focus()})},k=()=>{m.value&&t.articleLanguage.push(m.value),_.value=!1,m.value=""};return(l,e)=>{const i=s("el-button"),p=s("el-select-v2"),r=s("el-form-item"),g=s("el-input"),B=s("el-date-picker"),N=s("el-col"),S=s("el-tag"),K=s("el-form"),G=s("mavon-editor");return c(),w(D,null,[o(i,{type:"primary",icon:h(j),onClick:I,circle:""},null,8,["icon"]),o(K,{ref_key:"ruleFormRef",ref:b,model:t,rules:q,"label-width":"120px",class:"demo-ruleForm",size:U.value,inline:!0,"status-icon":""},{default:n(()=>[o(r,{label:"ID",prop:"id"},{default:n(()=>[o(p,{modelValue:t.id,"onUpdate:modelValue":e[0]||(e[0]=a=>t.id=a),placeholder:"ID",options:h(z)},null,8,["modelValue","options"])]),_:1}),o(r,{label:"文章标题",prop:"title",class:"max-w-lg"},{default:n(()=>[o(g,{modelValue:t.title,"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),maxlength:"50","show-word-limit":"",clearable:"true",type:"text"},null,8,["modelValue"])]),_:1}),o(r,{label:"文章简介",prop:"tabloid",class:"w-full"},{default:n(()=>[o(g,{modelValue:t.tabloid,"onUpdate:modelValue":e[2]||(e[2]=a=>t.tabloid=a),maxlength:"200","show-word-limit":"",clearable:"true",type:"textarea"},null,8,["modelValue"])]),_:1}),o(r,{label:"发布日期",required:""},{default:n(()=>[o(N,{span:11},{default:n(()=>[o(r,{prop:"date1"},{default:n(()=>[o(B,{modelValue:t.publishDate,"onUpdate:modelValue":e[3]||(e[3]=a=>t.publishDate=a),type:"date",placeholder:"Pick a date",style:{width:"100% max-width:100px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(r,{label:"阅读量",prop:"readingQuantity"},{default:n(()=>[o(g,{modelValue:t.readingQuantity,"onUpdate:modelValue":e[4]||(e[4]=a=>t.readingQuantity=a),type:"number",style:{"max-width":"120px"}},null,8,["modelValue"])]),_:1}),o(r,{label:"文章语言",prop:"articleLanguage",class:"w-full"},{default:n(()=>[(c(!0),w(D,null,E(t.articleLanguage,a=>(c(),y(S,{key:a,class:"mx-1",closable:"","disable-transitions":!1,onClose:Z=>R(a)},{default:n(()=>[f(J(a),1)]),_:2},1032,["onClose"]))),128)),_.value?(c(),y(g,{key:0,ref_key:"TagInputRef",ref:V,modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a),class:"ml-1",size:"small",onKeyup:M(k,["enter"]),onBlur:k,style:{"max-width":"85px"}},null,8,["modelValue","onKeyup"])):(c(),y(i,{key:1,class:"button-new-tag ml-1",size:"small",onClick:$},{default:n(()=>[f(" + New Tag ")]),_:1}))]),_:1}),o(r,{class:"pl-20"},{default:n(()=>[o(i,{type:"primary",onClick:e[6]||(e[6]=a=>P(b.value))},{default:n(()=>[f("提交")]),_:1}),o(i,{onClick:e[7]||(e[7]=a=>Q(b.value))},{default:n(()=>[f("重置")]),_:1})]),_:1})]),_:1},8,["model","rules","size"]),o(G,{ref_key:"mavon",ref:v,modelValue:t.content,"onUpdate:modelValue":e[8]||(e[8]=a=>t.content=a),onSave:F,onImgAdd:L,onImgDel:T},null,8,["modelValue"])],64)}}});export{le as default};
